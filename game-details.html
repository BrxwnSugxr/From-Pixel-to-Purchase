<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Document</title>
  </head>
  <body>
    <h1 class="text-center mb-[1rem]">Details</h1>
    <div id="game-detail-container" class="mb-[2rem] px-[10px]"></div>
    <h1 class="mb-[1rem]">Recommended Videos</h1>
    <div id="youtube-videos" class="flex w-ful gap-[1rem] px-[10px]"></div>
    <script type="module">
      const key = '66d3737f6f13454880d0fe3f9948fa06';
      const ytKey = `AIzaSyBoHe8CqIx0Alv1Jrh2Fzbi0DMiZ9xCmXc`;
      const gamespot = `69d28bae30a18b6675cbc3a0aa2a90d8c3719da3`;
      let game_id = window.location.search;
      game_id = game_id?.split('?game-id-')[1] ?? '';
      const gameContainer = document.querySelector(`#game-detail-container`);

      const response = await gameDetail(game_id);

      const mainContainer = document.querySelector('#youtube-videos');

      if (mainContainer) {
        const recommendedVideo = await recommendYoutubeVideo(
          response?.name,
          10000
        );

        for (let i = 0; i < recommendedVideo.length; i++) {
          const videoId = recommendedVideo[i]?.id?.videoId;
          const image = recommendedVideo[i]?.snippet?.thumbnails?.default?.url;

          mainContainer.insertAdjacentHTML(
            'beforeend',
            `
      <iframe width="250"
      src="https://www.youtube.com/embed/${videoId}"
      >
      </iframe>


                  `
          );
        }
      }

      console.log(response, 'game-details');
      gameContainer.insertAdjacentHTML(
        'beforeend',
        `<div   class="min-h-[100px] card card-compact bg-base-100 shadow-xl md:col-span-1">
                              <figure><img src="${
                                response.background_image
                              }" alt="${response.name}" /></figure>
                              <div class="card-body">
                              <h2 class="card-title">${response.name}</h2>
                              <ul >
                                  <li> Release Date:<span class="data"> ${
                                    response.released
                                  }</span></li>
                                  <li>Platforms:</li>
        <ul>
          ${response.platforms
            .map(
              (platformInfo) => `
            <li>

              <span class="data">Platform: ${
                platformInfo?.platform?.name ?? 'None'
              }</span>

              <!-- Add additional platform-related information here if needed -->
            </li>
          `
            )
            .join('')}
            <span class="data">Released At: ${
              response.released ?? 'None'
            }</span>
        </ul>
                                  <li>Rating: <span class="data">${
                                    response.rating
                                  }</span></li>
                                  <li>Rating Count: <span class="data">${
                                    response.ratings_count
                                  }</span></li>
                                  <li>Description : ${response.description_raw}</li>
                                  </ul>
                             
                      </div>

                  `
      );

      async function gameDetail(gameId) {
        try {
          const url = `https://api.rawg.io/api/games/${gameId}?key=${key}`;

          const response = await fetch(url, {
            method: 'GET',
            headers: {
              'content-type': 'application/json',
            },
          });

          const data = await response.json();
          console.log(data, 'game details');
          return data;
        } catch (error) {
          console.log('failed to get game details', error);
        }
      }

      async function recommendYoutubeVideo(search, viewCount = 100) {
        try {
          const response = await fetch(
            `https://youtube.googleapis.com/youtube/v3/search?part=snippet&order=rating&q=${search}&maxResults=${viewCount}&type=video&videoDefinition=high&key=${ytKey}`,
            {
              method: 'GET',
            }
          );
          const data = await response.json();
          return data?.items ?? [];
        } catch (error) {
          console.log('failed to fetch youtube videos');
        }
      }

      async function getGameVideos() {}
    </script>
  </body>
</html>
